/*Film & Genre by revenue
SQL query for anyswer the follwing questions: Which genres generate the most sales? What are the top 10 films by revenue?*/

SELECT F.name AS genre,
       SUM(A.amount) AS category_revenue
FROM payment A
INNER JOIN rental B ON A.rental_id = B.rental_id
INNER JOIN inventory C ON B.inventory_id = C.inventory_id
INNER JOIN film D ON C.film_id = D.film_id
INNER JOIN film_category E ON D.film_id = E.film_id
INNER JOIN category F ON E.category_id = F.category_id
GROUP BY F.name
ORDER BY category_revenue DESC;

/*Countries by revenue
SQL query for anyswer the follwing question: What are the top 3 countries by revenue?*/

SELECT  co.country AS country,
    SUM(p.amount) AS revenue
FROM payment p
JOIN rental r ON p.rental_id = r.rental_id
JOIN customer c ON r.customer_id = c.customer_id
JOIN address a ON c.address_id = a.address_id
JOIN city ci ON a.city_id = ci.city_id
JOIN country co ON ci.country_id = co.country_id
GROUP BY co.country
ORDER BY revenue DESC;

/*Countries by counter
SQL query for anyswer the follwing question: What are the top 3 countries by customer counts?*/

SELECT D.country AS country	
       COUNT(A.customer_id) AS customer_count	
FROM customer A	
JOIN address B ON A.address_id = B.address_id	
JOIN city C ON B.city_id = C.city_id	
JOIN country D ON C.country_id = D.country_id	
GROUP BY D.country	
ORDER BY customer_count DESC;	

/*Top 5 customers
SQL query for anyswer the follwing question: What are the top 3 countries by total amount paid?*/

WITH customer_table (customer_id, first_name, last_name, country, city, amount) AS 	
	(SELECT A.customer_id,  A.first_name, A.last_name,  E.country, D.city, G.amount
	FROM payment G					
		INNER JOIN customer A ON G.customer_id = A.customer_id				
		INNER JOIN address C ON A.address_id = C.address_id				
		INNER JOIN city D ON C.city_id = D.city_id				
		INNER JOIN country E ON D.country_id = E.country_id)				
SELECT DISTINCT customer_id, first_name, last_name, country, city		
		SUM (amount) AS total_amount_paid				
FROM customer_table						
GROUP BY customer_id, first_name, last_name, country, city		
ORDER BY total_amount_paid DESC						
LIMIT (5)						
